name: Elena Auto Post (LEGACY)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# âš ï¸ DEPRECATED: Ce workflow est remplacÃ© par Content Brain
# Les CRON sont dÃ©sactivÃ©s. GardÃ© pour dÃ©clenchement manuel uniquement.
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

on:
  # CRON DÃ‰SACTIVÃ‰S - Utilisez content-brain.yml
  # schedule: [...]
  
  workflow_dispatch:
    inputs:
      slot:
        description: 'Time slot (morning, midday, evening, night, late_night)'
        required: false
        default: ''
      test_mode:
        description: 'Test mode (no publish)'
        required: false
        default: 'false'
        type: boolean

jobs:
  auto-post-elena:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        working-directory: ./app
        run: npm install replicate

      - name: Determine slot from schedule
        id: slot
        run: |
          HOUR=$(date -u +%H)
          
          # Manual trigger with specific slot
          if [ -n "${{ github.event.inputs.slot }}" ]; then
            echo "slot=${{ github.event.inputs.slot }}" >> $GITHUB_OUTPUT
            echo "Using manual slot: ${{ github.event.inputs.slot }}"
            exit 0
          fi
          
          # Determine slot based on current UTC time
          if [ "$HOUR" -eq 8 ] || [ "$HOUR" -eq 7 ]; then
            echo "slot=morning" >> $GITHUB_OUTPUT
            echo "Detected morning slot (9h00 Paris)"
          elif [ "$HOUR" -eq 11 ] || [ "$HOUR" -eq 10 ]; then
            echo "slot=midday" >> $GITHUB_OUTPUT
            echo "Detected midday slot (12h30 Paris)"
          elif [ "$HOUR" -eq 18 ] || [ "$HOUR" -eq 17 ]; then
            echo "slot=evening" >> $GITHUB_OUTPUT
            echo "Detected evening slot (19h00 Paris)"
          elif [ "$HOUR" -eq 20 ] || [ "$HOUR" -eq 19 ]; then
            echo "slot=night" >> $GITHUB_OUTPUT
            echo "Detected night slot (21h30 Paris) - PRIME TIME"
          elif [ "$HOUR" -eq 22 ] || [ "$HOUR" -eq 21 ]; then
            echo "slot=late_night" >> $GITHUB_OUTPUT
            echo "Detected late_night slot (23h00 Paris)"
          else
            echo "slot=evening" >> $GITHUB_OUTPUT
            echo "Defaulting to evening slot"
          fi

      - name: Generate and Post Elena Carousel
        working-directory: ./app
        env:
          REPLICATE_API_TOKEN: ${{ secrets.REPLICATE_API_TOKEN }}
          CLOUDINARY_CLOUD_NAME: ${{ secrets.CLOUDINARY_CLOUD_NAME }}
          CLOUDINARY_API_KEY: ${{ secrets.CLOUDINARY_API_KEY }}
          CLOUDINARY_API_SECRET: ${{ secrets.CLOUDINARY_API_SECRET }}
          INSTAGRAM_ACCESS_TOKEN_ELENA: ${{ secrets.INSTAGRAM_ACCESS_TOKEN_ELENA }}
          INSTAGRAM_ACCOUNT_ID_ELENA: ${{ secrets.INSTAGRAM_ACCOUNT_ID_ELENA }}
        run: |
          SLOT="${{ steps.slot.outputs.slot }}"
          TEST="${{ github.event.inputs.test_mode }}"
          
          echo "ðŸŒŸ Starting Elena carousel generation"
          echo "ðŸ“… Slot: $SLOT"
          echo "ðŸ§ª Test mode: $TEST"
          
          node scripts/carousel-post-elena.mjs "$SLOT" "$TEST"

