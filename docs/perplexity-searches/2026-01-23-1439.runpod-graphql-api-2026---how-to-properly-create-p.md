# Perplexity Search Results

> Generated: 2026-01-23T13:39:27.302Z
> Model: sonar-pro
> Duration: 16.1s

---

## Problem

RunPod GraphQL API 2026 - how to properly create pod and wait for it to be ready - podFindAndDeployOnDemand mutation - check pod status runtime ports - correct way to poll for pod ready state


---

## Search Results

To create a pod using RunPod's GraphQL API (specifically `podFindAndDeployOnDemand` mutation), wait for it to be ready, check status and runtime ports, follow this step-by-step process using GraphQL queries/mutations over `https://api.runpod.io/graphql` with your API key.[1][2]

### 1. Create Pod with `podFindAndDeployOnDemand` Mutation
Use this mutation to find available GPU/CPU resources and deploy an on-demand pod. Replace variables with your config (e.g., GPU type ID from `gpuTypes` query, image, ports).

```graphql
mutation PodFindAndDeployOnDemand($input: PodFindAndDeployOnDemandInput!) {
  podFindAndDeployOnDemand(input: $input) {
    id
    name
    imageName
    desiredStatus
    machineId
    runtime {
      uptimeInSeconds
    }
  }
}
```

**Example variables (JSON)**:
```json
{
  "input": {
    "name": "my-test-pod",
    "imageName": "runpod/pytorch:2.4.0-py3.11-cuda12.4.1-devel-ubuntu22.04",
    "gpuTypeId": "NVIDIA RTX A6000",  // Get from gpuTypes query
    "gpuCount": 1,
    "containerDiskInGb": 20,
    "volumeInGb": 20,
    "volumeMountPath": "/workspace",
    "ports": [
      { "hostPort": 8888, "containerPort": 8888 }
    ],
    "env": [{ "key": "MY_VAR", "value": "value" }]
  }
}
```

**cURL example**:
```bash
curl -X POST 'https://api.runpod.io/graphql?api_key=YOUR_API_KEY' \
  -H 'Content-Type: application/json' \
  -d '{
    "query": "mutation PodFindAndDeployOnDemand($input: PodFindAndDeployOnDemandInput!) { podFindAndDeployOnDemand(input: $input) { id name imageName desiredStatus machineId runtime { uptimeInSeconds } } }",
    "variables": { "input": { ... } }
  }'
```
Response includes `id` (save this for polling).[1][2]

### 2. Poll Pod Status Until Ready
Poll the `pod` query every 5-10 seconds until `runtime.uptimeInSeconds > 0` and `desiredStatus` matches `RUNNING` (or check `ports` array for assigned `publicPort`/`ip`). Key ready indicators: `runtime.ports` populated, `uptimeInSeconds` > 30s, no errors in `lastStatusChange`.[1][2]

```graphql
query GetPodStatus($input: PodFilter!) {
  pod(input: $input) {
    id
    name
    desiredStatus
    runtime {
      uptimeInSeconds
      ports {
        ip
        isIpPublic
        privatePort
        publicPort
        type
      }
      gpus {
        id
        gpuUtilPercent
        memoryUtilPercent
      }
      container {
        cpuPercent
        memoryPercent
      }
    }
    lastStatusChange
    ipAddress {
      ip
    }
  }
}
```

**Variables**:
```json
{ "input": { "podId": "YOUR_POD_ID" } }
```

**Python polling example** (using `requests` and `gql` for 2026 GraphQL client):
```python
import requests
import time
from gql import gql, Client
from gql.transport.requests import RequestsHTTPTransport

API_KEY = "YOUR_API_KEY"
ENDPOINT = "https://api.runpod.io/graphql"
transport = RequestsHTTPTransport(url=ENDPOINT, headers={"api-key": API_KEY})
client = Client(transport=transport)

POD_ID = "your_pod_id_from_creation"

query = gql("""
  query GetPodStatus($input: PodFilter!) {
    pod(input: $input) {
      id desiredStatus runtime { uptimeInSeconds ports { ip isIpPublic privatePort publicPort type } } lastStatusChange
    }
  }
""")

def wait_for_pod_ready(pod_id, max_wait=600, poll_interval=10):
    start_time = time.time()
    while time.time() - start_time < max_wait:
        result = client.execute(query, variable_values={"input": {"podId": pod_id}})
        pod = result["pod"]
        print(f"Status: {pod['desiredStatus']}, Uptime: {pod['runtime']['uptimeInSeconds']}s")
        
        ports = pod["runtime"]["ports"]
        if pod["runtime"]["uptimeInSeconds"] > 30 and pod["desiredStatus"] == "RUNNING" and ports:
            print("Pod ready! Ports:", ports)
            return pod, ports[0]["publicPort"]  # e.g., access via http://ports[0].ip:publicPort
        
        time.sleep(poll_interval)
    raise TimeoutError("Pod not ready within timeout")

pod_data, public_port = wait_for_pod_ready(POD_ID)
```
Poll logic: Ready when `uptimeInSeconds > 30`, `desiredStatus: "RUNNING"`, and `ports` has `publicPort` assigned (confirms network ready).[1][2]

### 3. Check Runtime Ports and Status Post-Ready
Once ready, query shows:
- **Ports**: Array with `privatePort` (container), `publicPort` (external), `ip`, `isIpPublic`.[1][2]
- **Runtime**: `gpus` (utilization), `container` (CPU/memory %).[2]
- **Status fields**: `desiredStatus` (target), `lastStatusChange` (events).[1]

Example ready response snippet:
```
{
  "runtime": {
    "uptimeInSeconds": 45,
    "ports": [{"ip": "xxx.runpod.io", "publicPort": 12345, "privatePort": 8888}]
  },
  "desiredStatus": "RUNNING"
}
```
Connect via `http://<ip>:<publicPort>` (e.g., Jupyter on 8888).[2]

### Common Issues/Tips (2026)
- Get GPU types first: `query { gpuTypes { id displayName memoryInGb stockStatus } }` for availability.[2][9]
- Rate limits: Poll ≤10s intervals; use WebSocket subscriptions if available for status (check spec).[1]
- Errors: If `lowestBidPriceToResume` appears, pod is spot—use `podBidResume` instead.[2]
- Python SDK alternative: `runpod.create_pod()` wraps this but lacks full GraphQL control.[5]
- For CPU-only: Use `cpuFlavorId` in input (SDK-limited).[7]

This matches official spec/docs as of 2026; test with your API key.[1][2]

---

## Citations

1. https://graphql-spec.runpod.io
2. https://docs.runpod.io/sdks/graphql/manage-pods
3. https://github.com/blib-la/captain/issues/220
4. https://lib.rs/crates/halldyll_starter_runpod
5. https://pypi.org/project/runpod/
6. https://www.answeroverflow.com/m/1217872885209628683
7. https://github.com/runpod/runpod-python/issues/314
8. https://runpod.ghost.io/streamline-gpu-cloud-management-with-runpods-new-rest-api/
9. https://www.answeroverflow.com/m/1376633009234510015

---

## Related Questions

- How can I monitor the status of a pod in real-time
- What are the best practices for polling pod readiness
- How do I check the runtime ports of a pod
- Can I automate the creation and deployment of pods using GraphQL
- What are the common errors when creating pods with RunPod GraphQL API

---

## Suggested Next Steps

Based on the search results above:

1. Review the most relevant citations for deeper understanding
2. Try the suggested solutions in order of relevance
3. If the problem persists, refine the search with more specific details

---

*Search powered by Perplexity Sonar Pro*
